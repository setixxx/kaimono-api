@hostname = localhost
@port = 8080
@baseURL = http://{{hostname}}:{{port}}

// =================================================================================================
//                                     ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ
// =================================================================================================

// Переменные для тестового пользователя
@user_email = testuser@example.com
@user_password = newPassword123
@user_name = Test
@user_surname = User
@user_phone = +1234567890

// Переменные для ID (будут установлены после успешного создания ресурсов)


// Замените на публичный ID существующего продукта для тестирования
@product_public_id_exists = 32c224f6-75a1-45e6-9297-01548047342a
@product_size_id_exists = 1

// =================================================================================================
//                                      АУТЕНТИФИКАЦИЯ (/auth)
// =================================================================================================

### 1. Регистрация нового пользователя (POST /auth/register)
POST {{baseURL}}/auth/register
Content-Type: application/json

{
    "name": "{{user_name}}",
    "surname": "{{user_surname}}",
    "phone": "{{user_phone}}",
    "email": "{{user_email}}",
    "birthday": "1990-01-01",
    "gender": "male",
    "password": "{{user_password}}"
}

> {% client.global.set("user_public_id", response.body.public_id); %}


### 2. Логин пользователя (POST /auth/login)
POST {{baseURL}}/auth/login
Content-Type: application/json

{
    "email": "{{user_email}}",
    "password": "{{user_password}}"
}

> {%
    client.global.set("refresh_token", response.body.refreshToken);
    client.global.set("access_token", response.body.accessToken);
%}


### 3. Обновление токена доступа (POST /auth/refresh)
// Должен использовать Refresh Token в заголовке Authorization
POST {{baseURL}}/auth/refresh
Authorization: Bearer {{refresh_token}}

// Сохраняем новый Access Token
> {%
    client.global.set("refresh_token", response.body.refreshToken);
    client.global.set("access_token", response.body.accessToken);
%}


### 4. Выход пользователя (POST /auth/logout)
// Должен использовать Refresh Token в заголовке Authorization
POST {{baseURL}}/auth/logout
Authorization: Bearer {{refresh_token}}

// =================================================================================================
//                                   ПУБЛИЧНЫЕ МАРШРУТЫ (Products & Reviews)
// =================================================================================================

### 5. Поиск продуктов (GET /products)
// Проверяем работу фильтрации и пагинации
GET {{baseURL}}/products?query=футболка&min_price=10.0&in_stock=true&page=1&page_size=5
Accept: application/json


### 6. Получение продукта по публичному ID (GET /products/{publicId})
GET {{baseURL}}/products/{{product_public_id_exists}}
Accept: application/json


### 7. Получение публичных отзывов для продукта (GET /products/{publicId}/reviews)
GET {{baseURL}}/products/{{product_public_id_exists}}/reviews
Accept: application/json

// =================================================================================================
//                                      ЗАЩИЩЕННЫЕ МАРШРУТЫ (JWT Auth)
// =================================================================================================

### 8. Тестовый защищенный маршрут (GET /)
GET {{baseURL}}/
Authorization: Bearer {{access_token}}


// =================================================================================================
//                                       ПОЛЬЗОВАТЕЛЬ (/user)
// =================================================================================================

### 9. Обновление информации о пользователе (POST /user/update-user)
POST {{baseURL}}/user/update-user
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
    "name": "UpdatedName",
    "phone": "{{user_phone}}"
}


### 10. Обновление пароля (POST /user/update-password)
POST {{baseURL}}/user/update-password
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
    "old_password": "{{user_password}}",
    "new_password": "newPassword123"
}


> {% client.global.set("user_password", "newPassword123"); %}

###
// =================================================================================================
//                                      АДРЕСА (/addresses)
// =================================================================================================

### 11. Создание нового адреса (POST /addresses)
POST {{baseURL}}/addresses
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "city": "Moscow",
  "street": "Tverskaya",
  "house": "1",
  "apartment": "123",
  "zip_code": "101000",
  "is_default": true
}

> {% client.global.set("address_id", response.body.id); %}


### 12. Получение списка адресов (GET /addresses)
GET {{baseURL}}/addresses
Authorization: Bearer {{access_token}}


### 13. Установка адреса по умолчанию (PATCH /addresses/{id}/set-default)
PATCH {{baseURL}}/addresses/{{address_id}}/set-default
Authorization: Bearer {{access_token}}


### 14. Удаление адреса (DELETE /addresses/{id})
DELETE {{baseURL}}/addresses/{{address_id}}
Authorization: Bearer {{access_token}}
// **Примечание:** Этот запрос должен идти последним в секции, чтобы не сломать тесты,
// которые могут использовать {{address_id}}. Для повторного теста нужно заново создать адрес.


// =================================================================================================
//                                   ПЛАТЕЖНЫЕ МЕТОДЫ (/payment-methods)
// =================================================================================================

### 15. Создание нового платежного метода (POST /payment-methods)
POST {{baseURL}}/payment-methods
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "card_number": "4111111111111112",
  "card_holder_name": "Test User",
  "expiry_month": 9,
  "expiry_year": 2026,
  "is_default": true
}

> {% client.global.set("payment_method_id", response.body.id); %}


### 16. Получение списка платежных методов (GET /payment-methods)
GET {{baseURL}}/payment-methods
Authorization: Bearer {{access_token}}


### 17. Установка платежного метода по умолчанию (PATCH /payment-methods/{id}/set-default)
PATCH {{baseURL}}/payment-methods/{{payment_method_id}}/set-default
Authorization: Bearer {{access_token}}


### 18. Удаление платежного метода (DELETE /payment-methods/{id})
DELETE {{baseURL}}/payment-methods/{{payment_method_id}}
Authorization: Bearer {{access_token}}
// **Примечание:** Этот запрос должен идти последним в секции.


// =================================================================================================
//                                       КОРЗИНА (/cart)
// =================================================================================================
// Перед тестами корзины убедитесь, что продукт с {{product_public_id_exists}} и {{product_size_id_exists}} существует.

### 19. Добавление товара в корзину (POST /cart/items)
POST {{baseURL}}/cart/items
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
    "product_public_id": "32c224f6-75a1-45e6-9297-01548047342a",
    "size_id": 1,
    "quantity": 2
}

###


### 20. Получение корзины (GET /cart)
GET {{baseURL}}/cart
Authorization: Bearer {{access_token}}


### 21. Обновление количества товара в корзине (PATCH /cart/items/{id})
PATCH {{baseURL}}/cart/items/13
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "quantity": 5
}


### 22. Удаление товара из корзины (DELETE /cart/items/{id})
DELETE {{baseURL}}/cart/items/14
Authorization: Bearer {{access_token}}



### 23. Очистка корзины (DELETE /cart)
DELETE {{baseURL}}/cart
Authorization: Bearer {{access_token}}


// =================================================================================================
//                                         ЗАКАЗЫ (/orders)
// =================================================================================================
// Для создания заказа нужна корзина с товарами и существующий адрес.
// Для тестов ниже предполагается, что вы создали адрес и добавили товар в корзину.

### 24. Создание заказа (POST /orders)
// Сначала повторим создание адреса и добавление товара в корзину для уверенности
// В реальном сценарии, используйте сохраненный {{address_id}}
POST {{baseURL}}/addresses
Content-Type: application/json
Authorization: Bearer {{access_token}}

{ "city": "Moscow", "street": "Tverskaya", "house": "1", "zip_code": "101000" }

> {% client.global.set("address_id", response.body.id); %}

###
// Добавление товара в корзину
POST {{baseURL}}/cart/items
Content-Type: application/json
Authorization: Bearer {{access_token}}

{ "product_public_id": "{{product_public_id_exists}}", "size_id": {{product_size_id_exists}}, "quantity": 1 }

###
POST {{baseURL}}/orders
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
    "address_id": {{address_id}}
}

> {% client.global.set("order_public_id", response.body.public_id); %}


### 25. Получение всех заказов пользователя (GET /orders)
GET {{baseURL}}/orders
Authorization: Bearer {{access_token}}


### 26. Получение конкретного заказа по публичному ID (GET /orders/{publicId})
GET {{baseURL}}/orders/{{order_public_id}}
Authorization: Bearer {{access_token}}


// =================================================================================================
//                                         ОТЗЫВЫ (/reviews)
// =================================================================================================

### 27. Создание отзыва (POST /reviews)
POST {{baseURL}}/reviews
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
    "product_public_id": "32c224f6-75a1-45e6-9297-01548047342a",
    "order_public_id": "c773aa7a-61ef-4fca-859f-17fc776dd037",
    "rating": 5,
    "comment": "This product is amazing!"
}

> {% client.global.set("review_id", response.body.id); %}


### 28. Получение отзывов пользователя (GET /reviews/my)
GET {{baseURL}}/reviews/my
Authorization: Bearer {{access_token}}


### 29. Обновление отзыва (PATCH /reviews/{id})
// DTO: UpdateReviewRequest (inferred: rating (optional), comment (optional))
PATCH {{baseURL}}/reviews/{{review_id}}
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
  "rating": 4,
  "comment": "It's good, but not perfect."
}


### 30. Удаление отзыва (DELETE /reviews/{id})
DELETE {{baseURL}}/reviews/{{review_id}}
Authorization: Bearer {{access_token}}
// **Примечание:** Этот запрос должен идти последним в секции.


// =================================================================================================
//                                         СПИСОК ЖЕЛАНИЙ (/wishlist)
// =================================================================================================

### 31. Добавление товара в список желаний (POST /wishlist)
// DTO: AddToWishlistRequest (inferred: product_public_id, size_id)
// Предполагаем, что ответ возвращает объект списка желаний.
// В реальном тесте нужно будет парсить массив items, чтобы получить wishlistItemId.
// Пока используем заглушку
// Замените 999 на ID первого элемента из ответа.
POST {{baseURL}}/wishlist
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
    "product_public_id": "32c224f6-75a1-45e6-9297-01548047342a",
    "size_id": 1
}



### 32. Получение списка желаний (GET /wishlist)
GET {{baseURL}}/wishlist
Authorization: Bearer {{access_token}}


### 33. Обновление размера товара в списке желаний (PATCH /wishlist/{id}/size)
// DTO: UpdateWishlistItemRequest (inferred: size_id)
// Временно используем заглушку для ID элемента.
PATCH {{baseURL}}/wishlist/999/size
Content-Type: application/json
Authorization: Bearer {{access_token}}

{
    "size_id": {{product_size_id_exists}}
}



### 34. Удаление товара из списка желаний (DELETE /wishlist/{id})
// Временно используем заглушку для ID элемента.
DELETE {{baseURL}}/wishlist/999
Authorization: Bearer {{access_token}}

// **Напоминание:** Замените 999 на реальный wishlist_item_id.


### 35. Очистка списка желаний (DELETE /wishlist)
DELETE {{baseURL}}/wishlist
Authorization: Bearer {{access_token}}