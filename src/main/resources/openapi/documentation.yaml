openapi: "3.0.3"
info:
  title: "Kaimono API"
  description: "A comprehensive e-commerce API for managing products, orders, cart, wishlist, and user accounts"
  version: "1.0.0"
servers:
  - url: "http://localhost:8080"
    description: "Local development server"

security:
  - bearerAuth: []

paths:
  # ==================== AUTH ROUTES ====================
  /auth/register:
    post:
      tags:
        - Authentication
      summary: "Register a new user"
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterUserRequest"
      responses:
        "201":
          description: "User registered successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegisterResponse"
        "400":
          description: "Invalid request body or validation error"
        "409":
          description: "User already exists"

  /auth/login:
    post:
      tags:
        - Authentication
      summary: "Login user"
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginUserRequest"
      responses:
        "200":
          description: "Login successful"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "400":
          description: "Invalid credentials"
        "401":
          description: "Unauthorized"

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: "Refresh access token"
      security:
        - bearerAuth: []
      description: "Requires refresh token in Authorization header"
      responses:
        "200":
          description: "Tokens refreshed successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginResponse"
        "401":
          description: "Invalid or expired refresh token"

  /auth/logout:
    post:
      tags:
        - Authentication
      summary: "Logout user"
      security:
        - bearerAuth: []
      description: "Requires refresh token in Authorization header"
      responses:
        "200":
          description: "Logged out successfully"
        "401":
          description: "Invalid token"

  # ==================== USER ROUTES ====================
  /user/update-password:
    post:
      tags:
        - User
      summary: "Update user password"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePasswordRequest"
      responses:
        "200":
          description: "Password updated successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdatePasswordResponse"
        "400":
          description: "Invalid data"
        "401":
          description: "Unauthorized"

  /user/update-user:
    post:
      tags:
        - User
      summary: "Update user information"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateUserInfoRequest"
      responses:
        "200":
          description: "User information updated successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UpdateUserInfoResponse"
        "400":
          description: "Invalid data"
        "401":
          description: "Unauthorized"

  /user/me:
    get:
      tags:
        - User
      summary: "Get current user info"
      security:
        - bearerAuth: [ ]
      responses:
        "200":
          description: "User details retrieved successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInfoResponse"
        "401":
          description: "Unauthorized"
        "500":
          description: "Internal server error"

  # ==================== ADDRESS ROUTES ====================
  /addresses:
    get:
      tags:
        - Addresses
      summary: "Get all user addresses"
      responses:
        "200":
          description: "List of addresses"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AddressResponse"
        "401":
          description: "Unauthorized"

    post:
      tags:
        - Addresses
      summary: "Create a new address"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateAddressRequest"
      responses:
        "201":
          description: "Address created successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AddressResponse"
        "400":
          description: "Invalid data"
        "401":
          description: "Unauthorized"

  /addresses/{id}/set-default:
    patch:
      tags:
        - Addresses
      summary: "Set address as default"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: "Default address updated"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AddressResponse"
        "400":
          description: "Invalid address ID"
        "401":
          description: "Unauthorized"

  /addresses/{id}:
    delete:
      tags:
        - Addresses
      summary: "Delete an address"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: "Address deleted successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        "400":
          description: "Invalid address ID"
        "401":
          description: "Unauthorized"

  # ==================== PAYMENT METHODS ROUTES ====================
  /payment-methods:
    get:
      tags:
        - Payment Methods
      summary: "Get all user payment methods"
      responses:
        "200":
          description: "List of payment methods"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PaymentMethodResponse"
        "401":
          description: "Unauthorized"

    post:
      tags:
        - Payment Methods
      summary: "Create a new payment method"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreatePaymentMethodRequest"
      responses:
        "201":
          description: "Payment method created successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentMethodResponse"
        "400":
          description: "Invalid data"
        "401":
          description: "Unauthorized"

  /payment-methods/{id}/set-default:
    patch:
      tags:
        - Payment Methods
      summary: "Set payment method as default"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: "Default payment method updated"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PaymentMethodResponse"
        "400":
          description: "Invalid payment method ID"
        "401":
          description: "Unauthorized"

  /payment-methods/{id}:
    delete:
      tags:
        - Payment Methods
      summary: "Delete a payment method"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: "Payment method deleted successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        "400":
          description: "Invalid payment method ID"
        "401":
          description: "Unauthorized"

    # ==================== CATEGORY ROUTES ====================
  /categories:
    get:
      tags:
        - Categories
      summary: "Get all categories"
      parameters:
        - name: parent_id
          in: query
          schema:
            type: integer
            format: int64
          required: false
          description: "Filter categories by parent ID"
      responses:
        "200":
          description: "List of categories"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/CategoryResponse"
        "500":
          description: "Internal server error"

  /categories/{id}:
    get:
      tags:
        - Categories
      summary: "Get category by ID"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: "Category details"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CategoryResponse"
        "400":
          description: "Invalid category ID"
        "404":
          description: "Category not found"
        "500":
          description: "Internal server error"

  # ==================== PRODUCT ROUTES ====================
  /products:
    get:
      tags:
        - Products
      summary: "Search and filter products"
      security: []
      parameters:
        - name: query
          in: query
          schema:
            type: string
          description: "Search query for product name or description"
        - name: category_ids
          in: query
          schema:
            type: string
          description: "Comma-separated list of category IDs"
        - name: min_price
          in: query
          schema:
            type: number
            format: double
        - name: max_price
          in: query
          schema:
            type: number
            format: double
        - name: in_stock
          in: query
          schema:
            type: boolean
        - name: sort_by
          in: query
          schema:
            type: string
            enum: [price, name, created]
        - name: sort_order
          in: query
          schema:
            type: string
            enum: [asc, desc]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 10
      responses:
        "200":
          description: "List of products"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductListResponse"
        "400":
          description: "Invalid request parameters"

  /products/{publicId}:
    get:
      tags:
        - Products
      summary: "Get product by public ID"
      security: []
      parameters:
        - name: publicId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: "Product details"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductResponse"
        "404":
          description: "Product not found"

  /products/{publicId}/reviews:
    get:
      tags:
        - Reviews
      summary: "Get product reviews"
      security: []
      parameters:
        - name: publicId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: "List of product reviews"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReviewResponse"
        "400":
          description: "Invalid product ID"

  # ==================== CART ROUTES ====================
  /cart:
    get:
      tags:
        - Cart
      summary: "Get user cart"
      responses:
        "200":
          description: "Cart details"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CartResponse"
        "401":
          description: "Unauthorized"

    delete:
      tags:
        - Cart
      summary: "Clear cart"
      responses:
        "200":
          description: "Cart cleared successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CartResponse"
        "401":
          description: "Unauthorized"

  /cart/items:
    post:
      tags:
        - Cart
      summary: "Add item to cart"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddToCartRequest"
      responses:
        "200":
          description: "Item added to cart"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CartResponse"
        "400":
          description: "Invalid data"
        "401":
          description: "Unauthorized"

  /cart/items/{id}:
    patch:
      tags:
        - Cart
      summary: "Update cart item quantity"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateCartItemRequest"
      responses:
        "200":
          description: "Cart item updated"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CartResponse"
        "400":
          description: "Invalid data"
        "401":
          description: "Unauthorized"

    delete:
      tags:
        - Cart
      summary: "Remove item from cart"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: "Item removed from cart"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CartResponse"
        "400":
          description: "Invalid cart item ID"
        "401":
          description: "Unauthorized"

  # ==================== ORDER ROUTES ====================
  /orders:
    get:
      tags:
        - Orders
      summary: "Get user orders"
      responses:
        "200":
          description: "List of orders"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/OrderResponse"
        "401":
          description: "Unauthorized"

    post:
      tags:
        - Orders
      summary: "Create a new order"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateOrderRequest"
      responses:
        "201":
          description: "Order created successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderResponse"
        "400":
          description: "Invalid data or empty cart"
        "401":
          description: "Unauthorized"

  /orders/{publicId}:
    get:
      tags:
        - Orders
      summary: "Get order by public ID"
      parameters:
        - name: publicId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: "Order details"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderResponse"
        "400":
          description: "Invalid order ID"
        "401":
          description: "Unauthorized"
        "404":
          description: "Order not found"

  # ==================== REVIEW ROUTES ====================
  /reviews:
    post:
      tags:
        - Reviews
      summary: "Create a review"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateReviewRequest"
      responses:
        "201":
          description: "Review created successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReviewResponse"
        "400":
          description: "Invalid data"
        "401":
          description: "Unauthorized"

  /reviews/my:
    get:
      tags:
        - Reviews
      summary: "Get user's reviews"
      responses:
        "200":
          description: "List of user reviews"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ReviewResponse"
        "401":
          description: "Unauthorized"

  /reviews/{id}:
    patch:
      tags:
        - Reviews
      summary: "Update a review"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateReviewRequest"
      responses:
        "200":
          description: "Review updated successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReviewResponse"
        "400":
          description: "Invalid data"
        "401":
          description: "Unauthorized"

    delete:
      tags:
        - Reviews
      summary: "Delete a review"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: "Review deleted successfully"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        "400":
          description: "Invalid review ID"
        "401":
          description: "Unauthorized"

  # ==================== WISHLIST ROUTES ====================
  /wishlist:
    get:
      tags:
        - Wishlist
      summary: "Get user wishlist"
      responses:
        "200":
          description: "Wishlist items"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WishlistResponse"
        "401":
          description: "Unauthorized"

    post:
      tags:
        - Wishlist
      summary: "Add item to wishlist"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddToWishlistRequest"
      responses:
        "200":
          description: "Item added to wishlist"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WishlistResponse"
        "400":
          description: "Invalid data"
        "401":
          description: "Unauthorized"

    delete:
      tags:
        - Wishlist
      summary: "Clear wishlist"
      responses:
        "200":
          description: "Wishlist cleared successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WishlistResponse"
        "401":
          description: "Unauthorized"

  /wishlist/{id}/size:
    patch:
      tags:
        - Wishlist
      summary: "Update wishlist item size"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateWishlistItemRequest"
      responses:
        "200":
          description: "Wishlist item updated"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WishlistResponse"
        "400":
          description: "Invalid data"
        "401":
          description: "Unauthorized"

  /wishlist/{id}:
    delete:
      tags:
        - Wishlist
      summary: "Remove item from wishlist"
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        "200":
          description: "Item removed from wishlist"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/WishlistResponse"
        "400":
          description: "Invalid wishlist item ID"
        "401":
          description: "Unauthorized"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    RegisterUserRequest:
      type: object
      required:
        - phone
        - email
        - password
      properties:
        phone:
          type: string
          example: "79001234567"
        email:
          type: string
          format: email
          example: "ivan@example.com"
        password:
          type: string
          format: password
          example: "password123"

    RegisterResponse:
      type: object
      properties:
        public_id:
          type: string
          format: uuid

    LoginUserRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "ivan@example.com"
        password:
          type: string
          format: password
          example: "password123"

    LoginResponse:
      type: object
      properties:
        refreshToken:
          type: string
          nullable: true
        accessToken:
          type: string
          nullable: true

    UpdatePasswordRequest:
      type: object
      required:
        - old_password
        - new_password
      properties:
        old_password:
          type: string
          format: password
        new_password:
          type: string
          format: password

    UpdatePasswordResponse:
      type: object
      properties:
        password_update_status:
          type: string
          example: "Password updated successfully"

    UpdateUserInfoRequest:
      type: object
      properties:
        name:
          type: string
        surname:
          type: string
        phone:
          type: string
        email:
          type: string
          format: email
        birthDate:
          type: string
          format: date
        gender:
          type: string
          enum: [Male, Female]

    UpdateUserInfoResponse:
      type: object
      properties:
        user_update_status:
          type: string
          example: "User updated successfully"

    UserInfoResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        surname:
          type: string
          nullable: true
        phone:
          type: string
        email:
          type: string
          format: email
        birthDate:
          type: string
          format: date
          nullable: true
        gender:
          type: string

    CreateAddressRequest:
      type: object
      required:
        - city
        - street
        - house
        - zip_code
      properties:
        city:
          type: string
          example: "Москва"
        street:
          type: string
          example: "Тверская улица"
        house:
          type: string
          example: "12"
        apartment:
          type: string
          nullable: true
          example: "45"
        zip_code:
          type: string
          example: "125009"
        additional_info:
          type: string
          nullable: true
          example: "Домофон 45"
        is_default:
          type: boolean
          default: false

    AddressResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        city:
          type: string
        street:
          type: string
        house:
          type: string
        apartment:
          type: string
          nullable: true
        zip_code:
          type: string
        additional_info:
          type: string
          nullable: true
        is_default:
          type: boolean

    CreatePaymentMethodRequest:
      type: object
      required:
        - card_number
        - card_holder_name
        - expiry_month
        - expiry_year
        - cvv
      properties:
        card_number:
          type: string
          example: "4242424242424242"
          description: "Card number (13-19 digits)"
        card_holder_name:
          type: string
          example: "IVAN IVANOV"
          description: "Name on the card"
        expiry_month:
          type: integer
          format: int16
          minimum: 1
          maximum: 12
          example: 12
          description: "Card expiry month (1-12)"
        expiry_year:
          type: integer
          format: int16
          example: 2026
          description: "Card expiry year"
        cvv:
          type: string
          example: "123"
          pattern: "^[0-9]{3}$"
          description: "Card security code (3 digits)"
        is_default:
          type: boolean
          default: false
          description: "Set as default payment method"

    PaymentMethodResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: "Payment method ID. Special ID -1 represents cash payment."
          example: 1
        payment_type:
          type: string
          enum: [ card, cash ]
          description: "Payment method type"
          example: "card"
        card_number_last4:
          type: string
          nullable: true
          example: "4242"
          description: "Last 4 digits of card (null for cash)"
        card_holder_name:
          type: string
          nullable: true
          example: "IVAN IVANOV"
          description: "Card holder name (null for cash)"
        expiry_month:
          type: integer
          format: int16
          nullable: true
          example: 12
          description: "Card expiry month (null for cash)"
        expiry_year:
          type: integer
          format: int16
          nullable: true
          example: 2026
          description: "Card expiry year (null for cash)"
        cvv:
          type: string
          nullable: true
          example: "123"
          description: "Card security code (null for cash)"
        is_default:
          type: boolean
          description: "Is this the default payment method. Cash is default if no card methods exist or none are marked as default."
          example: false

    ProductListResponse:
      type: object
      properties:
        products:
          type: array
          items:
            $ref: "#/components/schemas/ProductResponse"
        total_count:
          type: integer
          format: int64
        page:
          type: integer
        page_size:
          type: integer

    ProductResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        public_id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        base_price:
          type: string
          example: "1299.00"
        is_available:
          type: boolean
        categories:
          type: array
          items:
            $ref: "#/components/schemas/CategoryResponse"
        sizes:
          type: array
          items:
            $ref: "#/components/schemas/ProductSizeResponse"
        images:
          type: array
          items:
            $ref: "#/components/schemas/ProductImageResponse"
        average_rating:
          type: number
          format: double
          nullable: true
          minimum: 1
          maximum: 5
          description: "Average rating from reviews (1-5), null if no reviews"
          example: 4.5
        review_count:
          type: integer
          format: int64
          description: "Total number of reviews"
          example: 42

    CategoryResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        description:
          type: string
          nullable: true
        parent_id:
          type: integer
          format: int64
          nullable: true

    ProductSizeResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        size:
          type: string
          example: "M"
        stock_quantity:
          type: integer
        price_modifier:
          type: string
          example: "0.00"

    ProductImageResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        image_url:
          type: string
        is_primary:
          type: boolean
        display_order:
          type: integer

    AddToCartRequest:
      type: object
      required:
        - product_public_id
        - size_id
      properties:
        product_public_id:
          type: string
          format: uuid
        size_id:
          type: integer
          format: int64
        quantity:
          type: integer
          default: 1

    UpdateCartItemRequest:
      type: object
      required:
        - quantity
      properties:
        quantity:
          type: integer
          minimum: 1

    CartResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        items:
          type: array
          items:
            $ref: "#/components/schemas/CartItemResponse"
        total_price:
          type: string
          example: "5997.00"

    CartItemResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        product_id:
          type: integer
          format: int64
        product_name:
          type: string
        product_image:
          type: string
          nullable: true
        size:
          type: string
        quantity:
          type: integer
        price_per_item:
          type: string
        subtotal:
          type: string

    CreateOrderRequest:
      type: object
      required:
        - address_id
      properties:
        address_id:
          type: integer
          format: int64
          description: "Delivery address ID"
          example: 1
        payment_method_id:
          type: integer
          format: int64
          nullable: true
          description: "Payment method ID. Use -1 for cash payment, or actual card ID for card payment. Required only for card payments."
          example: 1
        payment_type:
          type: string
          enum: [card, cash]
          default: card
          description: "Payment type: 'card' or 'cash'"
          example: "card"

    OrderResponse:
      type: object
      properties:
        public_id:
          type: string
          format: uuid
        status:
          type: string
        total_amount:
          type: string
        created_at:
          type: string
          format: date-time
        items:
          type: array
          items:
            $ref: "#/components/schemas/OrderItemResponse"
        delivery_info:
          $ref: "#/components/schemas/DeliveryResponse"
          nullable: true
        payment_info:
          $ref: "#/components/schemas/PaymentInfoResponse"
          nullable: true

    OrderItemResponse:
      type: object
      properties:
        product_name:
          type: string
        size:
          type: string
        quantity:
          type: integer
        price_at_purchase:
          type: string
        subtotal:
          type: string

    DeliveryResponse:
      type: object
      properties:
        tracking_number:
          type: string
          nullable: true
        status:
          type: string
        estimated_date:
          type: string
          format: date
          nullable: true
        address:
          $ref: "#/components/schemas/AddressResponse"

    PaymentInfoResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: "Payment ID"
        amount:
          type: string
          example: "5997.00"
          description: "Payment amount"
        status:
          type: string
          example: "completed"
          description: "Payment status"
        payment_type:
          type: string
          enum: [card, cash]
          description: "Payment type"
        transaction_id:
          type: string
          nullable: true
          description: "Transaction ID"
        paid_at:
          type: string
          format: date-time
          nullable: true
          description: "Payment date (null for cash payments)"
        payment_method:
          $ref: "#/components/schemas/PaymentMethodInfoResponse"
          nullable: true

    PaymentMethodInfoResponse:
      type: object
      properties:
        card_number_last4:
          type: string
          example: "4242"
          description: "Last 4 digits of card"
        card_holder_name:
          type: string
          example: "IVAN IVANOV"
          description: "Card holder name"

    CreateReviewRequest:
      type: object
      required:
        - product_public_id
        - rating
      properties:
        product_public_id:
          type: string
          format: uuid
        order_public_id:
          type: string
          format: uuid
          nullable: true
        rating:
          type: integer
          format: int16
          minimum: 1
          maximum: 5
        comment:
          type: string
          nullable: true

    UpdateReviewRequest:
      type: object
      properties:
        rating:
          type: integer
          format: int16
          minimum: 1
          maximum: 5
          nullable: true
        comment:
          type: string
          nullable: true

    ReviewResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        user_name:
          type: string
        rating:
          type: integer
          format: int16
        comment:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time

    AddToWishlistRequest:
      type: object
      required:
        - product_public_id
        - product_size_id
      properties:
        product_public_id:
          type: string
          format: uuid
        product_size_id:
          type: integer
          format: int64

    UpdateWishlistItemRequest:
      type: object
      required:
        - product_size_id
      properties:
        product_size_id:
          type: integer
          format: int64

    WishlistResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/WishlistItemResponse"

    WishlistItemResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        product_public_id:
          type: string
          format: uuid
        product_name:
          type: string
        product_description:
          type: string
        product_image:
          type: string
          nullable: true
        base_price:
          type: string
        is_available:
          type: boolean
        selected_size_id:
          type: integer
          format: int64
          nullable: true
        selected_size:
          type: string
          nullable: true
        available_sizes:
          type: array
          items:
            $ref: "#/components/schemas/ProductSizeInfo"
        added_at:
          type: string
          format: date-time

    ProductSizeInfo:
      type: object
      properties:
        id:
          type: integer
          format: int64
        size:
          type: string
        stock_quantity:
          type: integer
        price_modifier:
          type: string
        final_price:
          type: string